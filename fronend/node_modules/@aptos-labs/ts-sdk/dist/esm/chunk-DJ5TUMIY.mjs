import{a as M,c as tn,d as en,e as N}from"./chunk-WFL6YWJS.mjs";import{q as nn,t as l}from"./chunk-KBRRTSF6.mjs";import{a as A}from"./chunk-WZNX3RBA.mjs";import{a as Y}from"./chunk-F5O5BBEK.mjs";import{a as an}from"./chunk-BGW77OLE.mjs";import{a as p,c as f,d as m}from"./chunk-QM4UQVGB.mjs";import{c as X,d as z,e as Z,f as $,g as j,h as J,i as Q}from"./chunk-2SPJ7XZB.mjs";import{a as L}from"./chunk-BWFJHFBQ.mjs";import{b as F,d as R,e as _,f as D}from"./chunk-6GZ5SUUK.mjs";import{a as K}from"./chunk-LGVHYLN2.mjs";import{b as w,d as g,e as v}from"./chunk-M3NK6GOI.mjs";import{a as O,b as E}from"./chunk-XRAL7KVT.mjs";import{a as G,c as k}from"./chunk-MFFSJJSY.mjs";import{a as x,c as B}from"./chunk-OATDMLDK.mjs";import{b as u}from"./chunk-IOSQVDZI.mjs";import{b}from"./chunk-AOCNYMMX.mjs";import{b as H}from"./chunk-KECXKWWV.mjs";import{a as q}from"./chunk-AH44UPM4.mjs";import{a as V}from"./chunk-E7OPTWPP.mjs";import{e as P}from"./chunk-XDGQTMDV.mjs";import{b as W,c as U,f as C,g as S}from"./chunk-CYNQRMO5.mjs";import{sha3_256 as rn}from"@noble/hashes/sha3";async function qn(n){if(nn(n))return yn(n);let{moduleAddress:e,moduleName:t,functionName:o}=l(n.function),r=await cn({key:"entry-function",moduleAddress:e,moduleName:t,functionName:o,aptosConfig:n.aptosConfig,abi:n.abi,fetch:tn});return fn({...n,abi:r})}function fn(n){let e=n.abi,{moduleAddress:t,moduleName:o,functionName:r}=l(n.function),a=M(n.typeArguments);if(a.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${a.length}`);let i=n.functionArguments.map((s,d)=>N(n.function,e,s,d,a));if(i.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${o}::${r}', expected ${e.parameters.length} but got ${i.length}`);let c=$.build(`${t}::${o}`,r,a,i);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new Z(new J(s,new Q(c)))}return new z(c)}async function Kn(n){let{moduleAddress:e,moduleName:t,functionName:o}=l(n.function),r=await cn({key:"view-function",moduleAddress:e,moduleName:t,functionName:o,aptosConfig:n.aptosConfig,abi:n.abi,fetch:en});return mn({abi:r,...n})}function mn(n){let e=n.abi,{moduleAddress:t,moduleName:o,functionName:r}=l(n.function),a=M(n.typeArguments);if(a.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${a.length}`);let i=n?.functionArguments?.map((c,s)=>N(n.function,e,c,s,a))??[];if(i.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${o}::${r}', expected ${e.parameters.length} but got ${i.length}`);return $.build(`${t}::${o}`,r,a,i)}function yn(n){return new X(new j(b.fromHexInput(n.bytecode).toUint8Array(),n.typeArguments??[],n.functionArguments))}async function gn(n){let{aptosConfig:e,sender:t,payload:o,options:r,feePayerAddress:a}=n,i=async()=>P[e.network]?{chainId:P[e.network]}:{chainId:(await V({aptosConfig:e})).chain_id},c=async()=>r?.gasUnitPrice?{gasEstimate:r.gasUnitPrice}:{gasEstimate:(await H({aptosConfig:e})).gas_estimate},s=async()=>{let T=async()=>r?.accountSequenceNumber!==void 0?r.accountSequenceNumber:(await K({aptosConfig:e,accountAddress:t})).sequence_number;if(a&&u.from(a).equals(u.ZERO))try{return await T()}catch{return 0}else return T()},[{chainId:d},{gasEstimate:y},I]=await Promise.all([i(),c(),s()]),{maxGasAmount:un,gasUnitPrice:An,expireTimestamp:dn}={maxGasAmount:r?.maxGasAmount?BigInt(r.maxGasAmount):BigInt(2e5),gasUnitPrice:BigInt(y),expireTimestamp:BigInt(Math.floor(Date.now()/1e3)+20),...r};return new p(u.from(t),BigInt(I),o,BigInt(un),BigInt(An),BigInt(dn),new L(d))}async function Hn(n){let{aptosConfig:e,sender:t,payload:o,options:r,feePayerAddress:a}=n,i=await gn({aptosConfig:e,sender:t,payload:o,options:r,feePayerAddress:a});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return new an(i,c,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new Y(i,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function Ln(n){let{signerPublicKey:e,transaction:t,secondarySignersPublicKeys:o,feePayerPublicKey:r}=n,a=h(e);if(t.feePayerAddress){let c=new m(t.rawTransaction,t.secondarySignerAddresses??[],t.feePayerAddress),s=[];o&&(s=o.map(I=>h(I)));let d=h(r),y=new _(a,t.secondarySignerAddresses??[],s,{address:t.feePayerAddress,authenticator:d});return new A(c.raw_txn,y).bcsToBytes()}if(t.secondarySignerAddresses){let c=new f(t.rawTransaction,t.secondarySignerAddresses),s=[];s=o.map(y=>h(y));let d=new R(a,t.secondarySignerAddresses,s);return new A(c.raw_txn,d).bcsToBytes()}let i;if(a instanceof w)i=new F(a.public_key,a.signature);else if(a instanceof g)i=new D(a);else throw new Error("Invalid public key");return new A(t.rawTransaction,i).bcsToBytes()}function h(n){if(n instanceof O){if(n.publicKey instanceof x)return new g(n,new E(new B(new Uint8Array(64))));if(n.publicKey instanceof G)return new g(n,new E(new k(new Uint8Array(64))))}return new w(new x(n.toUint8Array()),new B(new Uint8Array(64)))}function Xn(n){let{signer:e,transaction:t}=n,o=wn(t);return e.signWithAuthenticator(o)}function pn(n){let{transaction:e,senderAuthenticator:t,feePayerAuthenticator:o,additionalSignersAuthenticators:r}=n,a=sn(e);if((o||r)&&(a instanceof f||a instanceof m))return Tn(a,t,o,r);if(t instanceof w&&a instanceof p){let i=new F(t.public_key,t.signature);return new A(a,i).bcsToBytes()}if((t instanceof g||t instanceof v)&&a instanceof p){let i=new D(t);return new A(a,i).bcsToBytes()}throw new Error(`Cannot generate a signed transaction, ${t} is not a supported account authentication scheme`)}function on(n){let e=rn.create();for(let t of n)e.update(t);return e.digest()}var ln=on(["APTOS::Transaction"]);function zn(n){let e=pn(n);return new b(on([ln,new Uint8Array([0]),e])).toString()}function sn(n){return n.feePayerAddress?new m(n.rawTransaction,n.secondarySignerAddresses??[],n.feePayerAddress):n.secondarySignerAddresses?new f(n.rawTransaction,n.secondarySignerAddresses):n.rawTransaction}function Tn(n,e,t,o){if(n instanceof m){if(!t)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");let r=new _(e,n.secondary_signer_addresses,o??[],{address:n.fee_payer_address,authenticator:t});return new A(n.raw_txn,r).bcsToBytes()}if(n instanceof f){if(!o)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");let r=new R(e,n.secondary_signer_addresses,o??[]);return new A(n.raw_txn,r).bcsToBytes()}throw new Error(`Cannot prepare multi signers transaction to submission, ${typeof n} transaction is not supported`)}function wn(n){let e=sn(n),t=rn.create();if(e instanceof p)t.update(C);else if(e instanceof f)t.update(S);else if(e instanceof m)t.update(S);else throw new Error(`Unknown transaction type to sign on: ${e}`);let o=t.digest(),r=e.bcsToBytes(),a=new Uint8Array(o.length+r.length);return a.set(o),a.set(r,o.length),a}async function cn({key:n,moduleAddress:e,moduleName:t,functionName:o,aptosConfig:r,abi:a,fetch:i}){return a!==void 0?a:q(async()=>i(e,t,o,r),`${n}-${r.network}-${e}-${t}-${o}`,1e3*60*5)()}export{qn as a,fn as b,Kn as c,mn as d,gn as e,Hn as f,Ln as g,h,Xn as i,pn as j,on as k,zn as l,sn as m,Tn as n,wn as o};
//# sourceMappingURL=chunk-DJ5TUMIY.mjs.map